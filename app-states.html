<html><head><script>(function(){var Element=Object.create(HTMLElement.prototype);Element.clearContent=function(node){while(node.firstChild){node.removeChild(node.firstChild)}};Element.isParentOf=function(child,parent){var node=child.parentNode;while(node){if(node===parent)return true;else node=node.parentNode}return false};Element.directChildren=function(node,tag){var nodes=Array.isArray(node)?node:[node];var result=[];[].forEach.call(nodes,function(node){[].forEach.call(node.children,function(child){if(child.tagName==tag.toUpperCase())result.push(child)})});return result};Element.isArray=function(obj){return Object.prototype.toString.call(obj)==="[object Array]"};Element.fireEvent=function(type,detail,node){var event=document.createEvent("CustomEvent");event.initCustomEvent(type,false,true,detail);return node.dispatchEvent(event)};Element.parseUrl=function(location,mode){var url={isHashPath:mode==="hash"};if(typeof URL==="function"){var nativeUrl=new URL(location);url.path=nativeUrl.pathname;url.hash=nativeUrl.hash;url.search=nativeUrl.search}else{var anchor=document.createElement("a");anchor.href=location;url.path=anchor.pathname;if(url.path.charAt(0)!=="/"){url.path="/"+url.path}url.hash=anchor.hash;url.search=anchor.search}if(mode!=="pushstate"){if(url.hash.substring(0,2)==="#/"){url.isHashPath=true;url.path=url.hash.substring(1)}else if(url.hash.substring(0,3)==="#!/"){url.isHashPath=true;url.path=url.hash.substring(2)}else if(url.isHashPath){if(url.hash.length===0){url.path="/"}else{url.path=url.hash.substring(1)}}if(url.isHashPath){url.hash="";var secondHashIndex=url.path.indexOf("#");if(secondHashIndex!==-1){url.hash=url.path.substring(secondHashIndex);url.path=url.path.substring(0,secondHashIndex)}var searchIndex=url.path.indexOf("?");if(searchIndex!==-1){url.search=url.path.substring(searchIndex);url.path=url.path.substring(0,searchIndex)}}}return url};Element.testRoute=function(routePath,urlPath,trailingSlashOption,isRegExp){if(trailingSlashOption==="ignore"){if(urlPath.slice(-1)==="/"){urlPath=urlPath.slice(0,-1)}if(routePath.slice(-1)==="/"&&!isRegExp){routePath=routePath.slice(0,-1)}}if(isRegExp){return this.testRegExString(routePath,urlPath)}if(routePath===urlPath||routePath==="*"){return true}if(routePath.charAt(0)!=="/"){routePath="/**/"+routePath}return this.segmentsMatch(routePath.split("/"),1,urlPath.split("/"),1)};Element.segmentsMatch=function(routeSegments,routeIndex,urlSegments,urlIndex,pathVariables){var routeSegment=routeSegments[routeIndex]||"";var urlSegment=urlSegments[urlIndex]||"";if(routeSegment==="**"&&routeIndex===routeSegments.length-1){return true}if(routeSegment===""||urlSegment===""){return routeSegment===urlSegment}if(routeSegment===urlSegment||routeSegment==="*"||routeSegment.charAt(0)===":"){if(routeSegment.charAt(0)===":"&&typeof pathVariables!=="undefined"){pathVariables[routeSegment.substring(1)]=urlSegments[urlIndex]}return this.segmentsMatch(routeSegments,routeIndex+1,urlSegments,urlIndex+1,pathVariables)}if(routeSegment==="**"){for(var i=urlIndex;i<urlSegments.length;i++){if(this.segmentsMatch(routeSegments,routeIndex+1,urlSegments,i,pathVariables)){return true}}}return false};Element.routeArguments=function(routePath,urlPath,search,isRegExp,typecast){var args={};if(!isRegExp){if(routePath.charAt(0)!=="/"){routePath="/**/"+routePath}this.segmentsMatch(routePath.split("/"),1,urlPath.split("/"),1,args)}var queryParameters=search.substring(1).split("&");if(queryParameters.length===1&&queryParameters[0]===""){queryParameters=[]}for(var i=0;i<queryParameters.length;i++){var queryParameter=queryParameters[i];var queryParameterParts=queryParameter.split("=");args[queryParameterParts[0]]=queryParameterParts.splice(1,queryParameterParts.length-1).join("=")}if(typecast){for(var arg in args){args[arg]=this.typecast(args[arg])}}return args};Element.typecast=function(value){if(value==="true"){return true}if(value==="false"){return false}if(!isNaN(value)&&value!==""&&value.charAt(0)!=="0"){return+value}return decodeURIComponent(value)};Element.testRegExString=function(pattern,value){if(pattern.charAt(0)!=="/"){return false}pattern=pattern.slice(1);var options="";if(pattern.slice(-1)==="/"){pattern=pattern.slice(0,-1)}else if(pattern.slice(-2)==="/i"){pattern=pattern.slice(0,-2);options="i"}else{return false}return new RegExp(pattern,options).test(value)};document.registerElement("states-helper",{prototype:Element})})();</script><script>(function(){function Cache(name){this.name=name;this.internalCache={}}Cache.prototype.get=function(key,def){return this.internalCache[key]};Cache.prototype.set=function(key,value){if(this.get(key))throw Error("Already have an id :"+key);this.internalCache[key]=value};Cache.prototype.del=function(key){if(!this.get(key))throw Error("Cannot delete a non-existing id :"+key);delete this.internalCache[key]};Cache.prototype.items=function(){return this.internalCache};Cache.prototype.itemsArray=function(){var result=[];for(var k in this.internalCache)result.push(this.internalCache[k]);return result};var cacheList={};function defineCache(name){var newCache=cacheList[name];if(!newCache){cacheList[name]=newCache=new Cache(name)}return newCache}var Element=Object.create(HTMLElement.prototype);Element.getCache=function(name){return defineCache.call(this,name)};document.registerElement("view-registry",{prototype:Element})})();</script></head><body><div hidden=""><polymer-element name="place-holder" attributes="el" assetpath="../"><script>(function(){Polymer("place-holder",{created:function(){if(!this.hasAttribute("id"))throw Error("place-holder should vahe a unique id");this.cache=document.createElement("view-registry").getCache("place-holder:id");this.cache.set("#"+this.id,this)},clearContent:function(){while(this.firstChild){this.removeChild(this.firstChild)}},loadInto:function(attrList,control){var removeList=[];for(var att,i=0,atts=this.attributes,n=atts.length;i<n;i++){att=atts[i];if(att.nodeName.toUpperCase()!="ID"){removeList.push(att.nodeName.toUpperCase())}}for(var prop in attrList){this.setAttribute(prop,attrList[prop]);var exist=removeList.indexOf(prop.toUpperCase());if(exist>=0)removeList.splice(exist,1)}removeList.forEach(function(attr){this.removeAttribute(attr)}.bind(this));this.appendChild(control)},detached:function(){this.cache.del("#"+this.id)}})})();</script></polymer-element><polymer-element name="virtual-view" hidden="" attributes="target el discardAttr" assetpath="../"><template><states-helper id="helper"></states-helper></template><script>(function(){Polymer("virtual-view",{virtualHolder:"__$virtual$",created:function(){this.holderCache=document.createElement("view-registry").getCache("place-holder:id");this.cache=document.createElement("view-registry").getCache("virtual-view:target");this.target=this.getAttribute("target");if(!this.target){this.target=this.virtualHolder;this.setAttribute("target",this.target)}var stateviews=this.cache.get(this.target);if(!stateviews)this.cache.set(this.target,[this]);else stateviews.push(this);var discardAttr=["ID","TARGET","HIDDEN","EL","DISCARDATTR"];if(this.hasAttribute("discardAttr")){var attr=this.getAttribute("discardAttr").split(" ");attr.forEach(function(item){discardAttr.push(item.toUpperCase())})}this.discardAttr=discardAttr},detached:function(){delete this.instance;var stateviews=this.cache.get(this.target);if(stateviews&&stateviews.length)if(stateviews.indexOf(this)>=0)stateviews.splice(stateviews.indexOf(this),1)},changeModel:function(model){var targetModel=this.templateUsed?this.instance.templateInstance.model:this.instance;for(var property in model){if(model.hasOwnProperty(property)){targetModel[property]=model[property]}}},clearContent:function(){if(!this.instance)return;var holder=this.holderCache.get(this.target);if(!holder&&this.target!=this.virtualHolder){console.log("virtual-view:Clear: Cannot locate target "+this.target)}else{if(holder){holder.clearContent()}else document.body.removeChild(this.instance);delete this.instance;delete this.templateUsed}},loadIntoHolder:function(holder,instance){var nodes=[],values=[];var attrList={};for(var att,i=0,atts=this.attributes,n=atts.length;i<n;i++){att=atts[i];if(this.discardAttr.indexOf(att.nodeName.toUpperCase())<0){attrList[att.nodeName]=att.value||att.nodeValue}}holder.loadInto(attrList,instance)},loadInto:function(holder,model){var instance,self=this;if(holder){var instances=this.cache.get(this.target);instances.forEach(function(presenter){if(self!=presenter&&presenter.instance&&presenter.target!=self.virtualHolder)presenter.clearContent()});holder.clearContent()}if(this.el){instance=document.createElement(this.el)}else{var template=this.firstElementChild;if(template&&template.tagName=="TEMPLATE"){instance=template.createInstance(model);this.templateUsed=true}}if(instance){if(holder){this.instance=instance;if(!this.templateUsed){for(var property in model){if(model.hasOwnProperty(property)){instance[property]=model[property]}}}this.loadIntoHolder(holder,this.instance)}else{if(this.templateUsed){var foo=document.createElement("div");foo.appendChild(instance);this.instance=foo}else this.instance=instance;document.body.appendChild(this.instance)}}},loadContent:function(model){if(this.instance){throw Error("Presenter already loaded. Clear first.")}var holder=this.holderCache.get(this.target);if(!holder&&this.target!=this.virtualHolder){throw Error("Presenter should have a valid el attribute or first child should be template element.")}else{this.loadInto(holder,model)}}})})();</script></polymer-element><polymer-element name="app-state" attributes="header url forceReload regex model" hidden="" assetpath="../"><template><states-helper id="helper"></states-helper></template><script>(function(){function viewsOfState(viewList,parentList,map){var result=[];parentList.forEach(function(state){viewList.forEach(function(viewItems){viewItems.forEach(function(viewItem){if(viewItem.parentNode===state)result.push(map?map(viewItem):viewItem)})})});return result}function unloadStatesAndGetHierarchy(targetState,stateHierarchy){stateHierarchy=stateHierarchy||[];var unloadSiblingStates=function(state){var next=state.nextElementSibling;while(next){if(next.tagName=="APP-STATE"&&next.loaded)next.unLoad();next=next.nextElementSibling}var previous=state.previousElementSibling;while(previous){if(previous.tagName=="APP-STATE"&&previous.loaded)previous.unLoad();previous=previous.previousElementSibling}};var node=targetState.parentNode;stateHierarchy.splice(0,0,targetState);while(node&&node.tagName==="APP-STATE"){stateHierarchy.splice(0,0,node);unloadSiblingStates(node);node=node.parentNode}unloadSiblingStates(targetState);var children=targetState.querySelectorAll("app-state");[].map.call(children,function(childState){if(childState&&childState.tagName=="APP-STATE"&&childState.loaded)childState.unLoad()})}function loadState(hierarchy,contentPresenters,loadedPresenters){var visitState=function(state,presenters,childPresenters){var directChildren=presenters.map(function(view){return view.target});var childrenOfChildren=childPresenters.map(function(view){return view.target});var stateWasLoaded=state.loaded;for(var i=0;i<directChildren.length;i++){var presenter=presenters[i];if(childrenOfChildren.indexOf(directChildren[i])<0){if(stateWasLoaded){if(typeof state.forceReload!="undefined"){state.unLoad();stateWasLoaded=false}if(!presenter.instance)presenter.loadContent(state.getModel());else{presenter.changeModel(state.getModel())}}else{presenter.loadContent(state.getModel())}}}if(!stateWasLoaded){state.loaded=true;console.log("State loaded:"+(state.id||state.header||"anonymous"))}};loadedPresenters=loadedPresenters||[];for(var i=0;i<hierarchy.length;i++){var state=hierarchy[i];var presenters=viewsOfState(contentPresenters,[state]);var childPresenters=viewsOfState(contentPresenters,hierarchy.slice(i+1));visitState.call(this,state,presenters,childPresenters)}}Polymer("app-state",{get parentState(){var node=this.parentNode;while(node){if(node.tagName=="APP-STATE")return node;node=node.parentNode}},getStateManager:function(){var node=this.parentNode;while(node){if(node.tagName=="APP-STATE-MANAGER")return node;node=node.parentNode}},created:function(){this.stateViewCache=document.createElement("view-registry").getCache("virtual-view:target")},ready:function(){if(this.hasAttribute("childStates")){var el=this.getAttribute("childStates");if(typeof el!="undefined"){var content=document.createElement(el);var states=this.$.helper.directChildren(content.shadowRoot,"app-state");states.forEach(function(state){this.appendChild(state)}.bind(this))}}},attached:function(){this.stateManager=this.getStateManager();if(!this.stateManager)this.stateManager=document.querySelector("body /deep/ app-state-manager")},getModel:function(){var url=this.stateManager.parseUrl();var urlParams=this.$.helper.routeArguments(this.url,url.path,url.search,this.regex,this.stateManager.typecast==="auto");var model=this.model,node=this.parentNode;while(!model&&node&&(node.tagName=="APP-STATE"||node.tagName=="APP-STATE-MANAGER")){model=node.model;node=node.parentNode}if(model&&model!==this.model){var instance=Object.create(model);model=instance}return{model:model,urlParams:urlParams,state:this}},load:function(){if(this.hasAttribute("redirect")){this.stateManager.go(this.getAttribute("redirect"),{replace:true});return}var hierarchy=[];unloadStatesAndGetHierarchy(this,hierarchy);loadState.call(this,hierarchy,this.stateViewCache.itemsArray())},unLoad:function(){var state=this;var node=this.children[0];while(node){if(node.tagName=="APP-STATE"&&node.loaded)node.unLoad();node=node.nextElementSibling}var allStateViewItems=this.stateViewCache.itemsArray(),stateViews=viewsOfState(allStateViewItems,[state],function(view){view.clearContent();return view});delete state.loaded;console.log("State unloaded: "+(state.id||state.header||"anonymous"))}})})();</script></polymer-element><polymer-element name="app-state-manager" hidden="" attributes="trailingSlash mode typecast init model" assetpath="../"><template><states-helper id="helper"></states-helper></template><script>(function(){var isIE="ActiveXObject"in window;var previousUrl={};function createStateTree(appState,url){var urlVal=appState.url;if(typeof urlVal=="undefined"){appState.url=url;urlVal=url}var node=appState.children[0];while(node){if(node.tagName=="APP-STATE")createStateTree(node,urlVal+node.id+"/");node=node.nextElementSibling}}Polymer("app-state-manager",{matchState:function(url){if(typeof url==="string")url=this.$.helper.parseUrl(url,this.mode);var stateFound,states=this.querySelectorAll("app-state");for(var i=0;i<states.length;i++){var state=states[i];if(this.$.helper.testRoute(state.url,url.path,this.trailingSlash,state.regex)){stateFound=state;break}}var eventDetail={match:stateFound};this.$.helper.fireEvent("state-match",eventDetail,this);return eventDetail.match},loadState:function(state){var eventDetail={from:this.currentState,to:state};if(!this.$.helper.fireEvent("state-changing",eventDetail,this)){return}state.load();this.oldState=this.currentState;this.currentState=state;var detail={oldState:this.oldState,currentState:state};this.$.helper.fireEvent("state-changed",detail,this);this.$.helper.fireEvent("app-state-changed",detail,document)},go:function(url,options){if(this.mode!=="pushstate"){url="#"+url}if(options&&options.replace===true){window.history.replaceState(null,null,url)}else{window.history.pushState(null,null,url)}try{var popstateEvent=new PopStateEvent("popstate",{bubbles:false,cancelable:false,state:{}});if("dispatchEvent_"in window){window.dispatchEvent_(popstateEvent)}else{window.dispatchEvent(popstateEvent)}}catch(error){var fallbackEvent=document.createEvent("CustomEvent");fallbackEvent.initCustomEvent("popstate",false,false,{state:{}});window.dispatchEvent(fallbackEvent)}},parseUrl:function(url,mode){url=url||window.location.href;mode=mode||this.mode;return this.$.helper.parseUrl(url,mode)},urlChangeHandler:function(){var url=this.parseUrl();if(url.hash!==previousUrl.hash&&url.path===previousUrl.path&&url.search===previousUrl.search&&url.isHashPath===previousUrl.isHashPath){this.scrollToHash(url.hash);return}var matchState=this.matchState(url);if(matchState&&typeof matchState.forceReload!="undefined"){}else if(previousUrl.isHashPath===url.isHashPath&&previousUrl.hash===url.hash&&previousUrl.path===url.path&&previousUrl.search===url.search)return;previousUrl=url;var eventDetail={url:url};if(!this.$.helper.fireEvent("url-change",eventDetail,this)){return}var state=this.matchState(url);if(state)this.loadState(state)},scrollToHash:function(hash){if(!hash)return;setTimeout(function(){var hashElement=document.querySelector("html /deep/ "+hash)||document.querySelector('html /deep/ [name="'+hash.substring(1)+'"]');if(hashElement&&hashElement.scrollIntoView){hashElement.scrollIntoView(true)}},0)},init:function(){if(this.isInited){return}this.isInited=true;this.mode=this.mode||"auto";this.trailingSlash=this.trailingSlash||"strict";this.typecast=this.typecast||"auto";window.addEventListener("popstate",this.urlChangeHandler.bind(this),false);if(isIE){window.addEventListener("hashchange",this.router.urlChangeHandler.bind(this),false)}this.urlChangeHandler();this.$.helper.fireEvent("states-inited",{},this)},domReady:function(){if(this.getAttribute("init")!=="manual")this.init()},ready:function(){var root=this.root=this.querySelector("app-state:first-child");if(root)createStateTree.call(this,root,"/")},detached:function(){window.removeEventListener("popstate",this.stateChangeHandler,false);if(isIE){window.removeEventListener("hashchange",this.stateChangeHandler,false)}}})})();</script></polymer-element></div></body></html>